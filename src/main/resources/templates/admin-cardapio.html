<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base :: layout (~{::title}, ~{::section})}">
<head>
    <title>Gerenciar Cardápio - Pedrão's Bar</title>
</head>
<body>

<section class="section">
    <div class="container">

        <!-- Navegação Superior -->
        <div style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center;">
            <a href="/admin/dashboard" style="color: #a0a0a0; text-decoration: none;">
                <i class="fas fa-arrow-left"></i> Voltar ao Painel
            </a>

            <!-- Botão para Criar Novo Item -->
            <a href="/admin/cardapio/novo" class="btn btn-primary btn-sm">
                <i class="fas fa-plus"></i> Novo Item
            </a>
        </div>

        <h2 class="section-title">Cardápio & Preços</h2>

        <!-- Feedback de Sucesso -->
        <div th:if="${param.sucesso}" style="margin-bottom: 20px; padding: 10px; background: rgba(39, 174, 96, 0.2); border: 1px solid #27ae60; color: #27ae60; border-radius: 4px; text-align: center;">
            <i class="fas fa-check"></i> Alterações salvas com sucesso!
        </div>

        <!-- CONFIGURAÇÃO RÁPIDA DE ENTRADA (NOVO) -->
        <div class="type-header" style="margin-bottom: 40px; border-radius: 8px; border-bottom: 1px solid #333;">
            <h3 class="type-title" style="font-size: 1.3rem;">
                <i class="fas fa-ticket-alt" style="margin-right: 10px; color: var(--accent);"></i>
                Valor da Entrada
            </h3>

            <!-- Form para editar o valor global da Entrada -->
            <form th:action="@{/admin/configuracoes/salvar-entrada}" method="post" class="inline-edit-form">
                <label style="color: #ccc; font-size: 0.9rem;">Couvert (R$):</label>
                <!-- Assumindo que o controller passa 'valorEntrada' no model -->
                <input type="number" step="0.50" name="valorEntrada" th:value="${valorEntrada}" class="input-mini" style="width: 100px;" placeholder="0.00">

                <button type="submit" class="btn btn-outline btn-sm" title="Atualizar Entrada">
                    <i class="fas fa-save"></i>
                </button>
            </form>
        </div>

        <!-- LOOP POR TIPO DE CARDÁPIO (Map<TiposCardapioDto, List<CardapioDto>>) -->
        <div th:each="entry : ${cardapioMap}">

            <!-- 1. CABEÇALHO DO TIPO (Editar Gorjeta) -->
            <div class="type-header">
                <h3 class="type-title" th:text="${entry.key.nome}">Bebidas</h3>

                <!-- Form para editar a gorjeta deste Tipo -->
                <form th:action="@{/admin/tipos/salvar}" method="post" class="inline-edit-form">
                    <input type="hidden" name="id" th:value="${entry.key.id}">
                    <input type="hidden" name="nome" th:value="${entry.key.nome}">
                    <input type="hidden" name="ativado" th:value="${entry.key.ativado}">

                    <label style="color: #ccc; font-size: 0.9rem;">Taxa (%):</label>
                    <input type="number" step="0.1" name="percGorjeta" th:value="${entry.key.percGorjeta}" class="input-mini">

                    <button type="submit" class="btn btn-outline btn-sm" title="Salvar Taxa">
                        <i class="fas fa-save"></i>
                    </button>
                </form>
            </div>

            <!-- 2. LISTA DE ITENS DO TIPO -->
            <div class="items-table-container">

                <!-- Cabeçalho da Tabela Visual -->
                <div style="display: grid; grid-template-columns: 3fr 1fr 1fr 0.5fr; gap: 15px; padding-bottom: 10px; border-bottom: 1px solid #444; color: var(--accent); font-size: 0.8rem; text-transform: uppercase;">
                    <div>Item</div>
                    <div>Preço (R$)</div>
                    <div>Disponível</div>
                    <div>Ação</div>
                </div>

                <!-- Loop dos Itens -->
                <div th:each="item : ${entry.value}">

                    <!-- Form individual por item -->
                    <form th:action="@{/admin/cardapio/salvar}" method="post" class="edit-row">
                        <input type="hidden" name="id" th:value="${item.id}">
                        <input type="hidden" name="tipoId" th:value="${entry.key.id}"> <!-- Mantém vínculo -->

                        <!-- Nome (Editável ou Texto) -->
                        <div>
                            <input type="text" name="nome" th:value="${item.nome}" class="input-price" style="text-align: left;">
                        </div>

                        <!-- Preço -->
                        <div>
                            <input type="number" step="0.01" name="valor" th:value="${item.valor}" class="input-price" placeholder="0.00">
                        </div>

                        <!-- Toggle Ativado/Desativado -->
                        <div style="display: flex; align-items: center;">
                            <label class="switch">
                                <input type="checkbox" name="ativado" th:checked="${item.ativado}">
                                <span class="slider"></span>
                            </label>
                            <span style="margin-left: 10px; font-size: 0.8rem; color: #666;"
                                  th:text="${item.ativado ? 'Sim' : 'Não'}">Sim</span>
                        </div>

                        <!-- Botão Salvar -->
                        <div style="text-align: right;">
                            <button type="submit" class="btn btn-primary btn-sm" style="padding: 5px 10px;">
                                <i class="fas fa-save"></i>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Mensagem se não houver itens -->
                <div th:if="${#lists.isEmpty(entry.value)}" style="text-align: center; padding: 20px; color: #666; font-style: italic;">
                    Nenhum item cadastrado nesta categoria.
                </div>

            </div>
        </div> <!-- Fim do Loop de Tipo -->

    </div>
</section>

</body>
</html>
